var CryptoBotAPI=function(){"use strict";var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};var e=/^https?:\/\/((([a-z\d][a-z\d-]*[a-z\d])\.)+[a-z]{2,}|((\d{1,3}\.){3}\d{1,3}))(:\d+)?(\/[-a-z\d%_.~+]*)*$/i,n=function(t){return Array.isArray(t)?t.reduce((function(t,e){if(e.code){var n=e.code.toString(),r=void 0;e.is_blockchain&&(r="blockchain"),e.is_fiat&&(r="fiat"),e.is_stablecoin&&(r="stablecoin");var o={name:e.name||"",decimals:e.decimals||0,type:r};t[n]=o}return t}),{}):{}},r=function(t){return Array.isArray(t)?t.map((function(t){return{source:t.source||"",target:t.target||"",rate:parseFloat(t.rate)}})):[]},o=function(t){var e={id:t.invoice_id||0,status:t.status||"",hash:t.hash||"",currency:t.asset||"",amount:parseFloat(t.amount)||0,payUrl:t.pay_url||"",isAllowComments:t.allow_comments||!1,isAllowAnonymous:t.allow_anonymous||!1,createdAt:new Date(t.created_at),isConfirmed:t.is_confirmed||!1};return void 0!==t.paid_anonymously&&(e.isPaidAnonymously=t.paid_anonymously),void 0!==t.paid_at&&(e.paidAt=new Date(t.paid_at)),void 0!==t.confirmed_at&&(e.confirmedAt=new Date(t.confirmed_at)),void 0!==t.description&&(e.description=t.description),void 0!==t.payload&&(e.payload=t.payload),void 0!==t.paid_btn_name&&(e.paidBtnName=t.paid_btn_name),void 0!==t.paid_btn_url&&(e.paidBtnUrl=t.paid_btn_url),void 0!==t.comment&&(e.comment=t.comment),e},a=function(t){var e=[];return Array.isArray(t.items)&&(e=t.items.map(o)),{count:t.count||0,items:e}},i=function(t){return{id:t.app_id||0,name:t.name||"",bot:t.payment_processing_bot_username||""}},c=function(){function t(n,r){if(!t.KEY_CHECK_REGEXP.test(n))throw new Error("API key looks like invalid");var o,a;if("mainnet"===r||"https://pay.crypt.bot/app"===r)throw new Error("Mainnet disabled during api testing stage,pass 'testnet' or endpoint url in second parameter");if("testnet"===r)o="https://testnet-pay.crypt.bot/app";else{if(a=r,!e.test(a))throw new Error("Endpoint parameter not contain valid URL");o=r}this._baseUrl="".concat(o).concat(n,"/")}return t.prototype.call=function(t,e){void 0===e&&(e={});var n,r="";return Object.keys(e).forEach((function(t){var n=e[t];n=Array.isArray(n)?n.join(","):n.toString(),r+="&".concat(t,"=").concat(encodeURIComponent(n))})),(n=this._baseUrl+t+(r.length?"?".concat(r.substr(1)):""),new Promise((function(t,e){var r=new XMLHttpRequest;r.open("GET",n,!0),r.onreadystatechange=function(){4===r.readyState&&t(r.responseText)},r.onerror=function(){e(new Error("Network Error"))},r.send()}))).then((function(t){var e;try{e=JSON.parse(t)}catch(e){throw new Error("Response parse error, raw reponse:\n".concat(t))}if(!0!==e.ok){if(!e.error)throw new Error("Api response unknown error");throw new Error("Api response error ".concat(JSON.stringify(e.error)))}return e.result}))},t.KEY_CHECK_REGEXP=/\d{1,}:[a-zA-Z0-9]{35}/,t}(),s=function(t,e,n,r){var o,a=null,i=0;return function(c){if(void 0===c&&(c=!1),a)return a;var s=Math.floor(+new Date/1e3/r);return s!==i||c?(i=s,a=t.call(e).then((function(t){return o=n(t),a=null,o}))):Promise.resolve(o)}},u=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t._pageSize=100,t}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}(n,e),n.prototype.getPageSize=function(){return this._pageSize},n.prototype.setPageSize=function(t){var e=+t;if(e>1e3||e<1)throw Error("Page size may be from 1 to 1000");this._pageSize=e},n.prototype.getBalances=function(t,e){return void 0===t&&(t=!1),void 0===e&&(e=!1),Promise.all([this.getCurrencies(e),this._transport.call("getBalance")]).then((function(e){var n=e[0];return function(t,e,n){return Array.isArray(t)?t.reduce((function(t,r){return r.currency_code&&r.available&&(t[r.currency_code]=n?r.available:function(t,e,n){var r,o=t,a=(null===(r=n[e])||void 0===r?void 0:r.decimals)||8,i=a-o.length;if(i>0){for(var c="",s=0;s<i;s+=1)c+="0";o=c+o}if(o.length===a)o="0.".concat(o);else{var u=o.length-a;o="".concat(o.substr(0,u),".").concat(o.substr(u))}return o.replace(/0+$/,"")}(r.available,r.currency_code,e)),t}),{}):{}}(e[1],n,t)}))},n.prototype.getBalance=function(t,e,n){return void 0===e&&(e=!1),void 0===n&&(n=!1),this.getBalances(e,n).then((function(e){return void 0===e[t]?"0":e[t]}))},n.prototype.getCurrency=function(t,e){return void 0===e&&(e=!1),this.getCurrencies(e).then((function(e){return void 0===e[t]?null:e[t]}))},n.prototype.getExchangeRate=function(t,e,n){return void 0===n&&(n=!1),Promise.all([this.getCurrencies(n),this.getExchangeRates(n)]).then((function(n){var r=n[0],o=n[1];return function(t,e,n,r){for(var o,a=NaN,i=0,c=n.length;i<c;i+=1){var s=n[i];if(s.source===t&&s.target===e){a=s.rate;break}if(s.source===e&&s.target===t){a=1/s.rate;break}}if(isNaN(a))return 0;var u=(null===(o=r[e])||void 0===o?void 0:o.decimals)||8;return parseFloat(a.toFixed(u))}(t,e,o,r)}))},n.prototype.createInvoice=function(t){return this._transport.call("createInvoice",function(t){if(t.description&&t.description.length>1024)throw new Error("Description can't be longer than 1024 characters");if(t.payload&&t.payload.length>1024)throw new Error("Payload can't be longer than 1024 characters");if(t.paidBtnName&&!t.paidBtnUrl)throw new Error("Require paidBtnUrl parameter if paidBtnName parameter pass");var e={asset:t.currency,amount:+t.amount};return void 0!==t.description&&(e.description=t.description),void 0!==t.payload&&(e.payload=t.payload),void 0!==t.paidBtnUrl&&(e.paid_btn_url=t.paidBtnUrl),void 0!==t.paidBtnName&&(e.paid_btn_name=t.paidBtnName),void 0!==t.isAllowComments&&(e.allow_comments=t.isAllowComments),void 0!==t.isAllowAnonymous&&(e.allow_anonymous=t.isAllowAnonymous),e}(t)).then((function(t){return o(t)}))},n.prototype.confirmPayment=function(t){return this._transport.call("confirmPayment",{invoice_id:+t}).then((function(t){return o(t)}))},n.prototype.getInvoices=function(t){return void 0===t&&(t={}),this._transport.call("getInvoices",function(t){var e={};return void 0!==t.status&&(e.status=t.status),void 0!==t.offset&&(e.offset=t.offset),void 0!==t.count&&(e.count=t.count),void 0!==t.currency&&(e.asset=t.currency),void 0!==t.ids&&(e.invoices_ids=t.ids.map((function(t){return+t}))),e}(t)).then((function(t){return a(t)}))},n.prototype.getPayments=function(t){return void 0===t&&(t={}),this._transport.call("getPayments",t).then((function(t){return a(t)}))},n.prototype.getInvoicesPaginate=function(t){var e=this;void 0===t&&(t={});var n=function(t,e){var n={};void 0!==e.status&&(n.status=e.status),void 0!==e.currency&&(n.asset=e.currency),void 0!==e.ids&&(n.invoices_ids=e.ids.map((function(t){return+t})));var r=e.page?+e.page:1;return r<1&&(r=1),n.count=t,n.offset=t*(r-1),n}(this._pageSize,t);return this._transport.call("getInvoices",n).then((function(n){return r=t.page,a=e._pageSize,i=n,c=[],Array.isArray(i.items)&&(c=i.items.map(o)),{page:r,pagesCount:Math.ceil((i.count||0)/a),items:c};var r,a,i,c}))},n}(function(){function t(t,e){void 0===e&&(e="mainnet"),this._transport=new c(t,e)}return t.prototype.getCurrencies=function(e){return this._currenciesFetchHandler||(this._currenciesFetchHandler=s(this._transport,"getCurrencies",n,t._CURRENCIES_UPDATE_PERIOD)),this._currenciesFetchHandler(e)},t.prototype.getExchangeRates=function(e){return this._exchangeRatesFetchHandler||(this._exchangeRatesFetchHandler=s(this._transport,"getExchangeRates",r,t._EXCHANGE_RATES_UPDATE_PERIOD)),this._exchangeRatesFetchHandler(e)},t.prototype.getMe=function(e){return void 0===e&&(e=!1),this._meFetchHandler||(this._meFetchHandler=s(this._transport,"getMe",i,t._ME_UPDATE_PERIOD)),this._meFetchHandler(e)},t._CURRENCIES_UPDATE_PERIOD=3600,t._EXCHANGE_RATES_UPDATE_PERIOD=60,t._ME_UPDATE_PERIOD=3600,t}());return u}();
//# sourceMappingURL=crypto-bot-api.min.js.map

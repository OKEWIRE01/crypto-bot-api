var CryptoBotAPI=function(){"use strict";var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};var e=/^https?:\/\/((([a-z\d][a-z\d-]*[a-z\d])\.)+[a-z]{2,}|((\d{1,3}\.){3}\d{1,3}))(:\d+)?(\/[-a-z\d%_.~+]*)*$/i,r=function(t){return Array.isArray(t)?t.reduce((function(t,e){if(e.code){var r=e.code.toString(),n=void 0;e.is_blockchain&&(n="blockchain"),e.is_fiat&&(n="fiat"),e.is_stablecoin&&(n="stablecoin");var o={name:e.name||"",decimals:e.decimals||0,type:n};t[r]=o}return t}),{}):{}},n=function(t){return Array.isArray(t)?t.map((function(t){return{source:t.source||"",target:t.target||"",rate:parseFloat(t.rate)}})):[]},o=function(t){var e={id:t.invoice_id||0,status:t.status||"",hash:t.hash||"",currency:t.asset||"",amount:parseFloat(t.amount)||0,payUrl:t.pay_url||"",isAllowComments:t.allow_comments||!1,isAllowAnonymous:t.allow_anonymous||!1,createdAt:new Date(t.created_at)};if(void 0!==t.paid_anonymously&&(e.isPaidAnonymously=t.paid_anonymously),void 0!==t.paid_at&&(e.paidAt=new Date(t.paid_at)),void 0!==t.description&&(e.description=t.description),void 0!==t.paid_btn_name&&(e.paidBtnName=t.paid_btn_name),void 0!==t.paid_btn_url&&(e.paidBtnUrl=t.paid_btn_url),void 0!==t.comment&&(e.comment=t.comment),void 0!==t.payload){var r=void 0;try{r=JSON.parse(t.payload)}catch(e){r=t.payload}e.payload=r}return e},a=function(t){return{id:t.app_id||0,name:t.name||"",bot:t.payment_processing_bot_username||""}},i=function(){function t(r,n){if(!t.KEY_CHECK_REGEXP.test(r))throw new Error("API key looks like invalid");var o,a;if("mainnet"===n||"https://pay.crypt.bot/api"===n)throw new Error("Mainnet disabled during api testing stage,pass 'testnet' or endpoint url in second parameter");if("testnet"===n)o="https://testnet-pay.crypt.bot/api";else{if(a=n,!e.test(a))throw new Error("Endpoint parameter not contain valid URL");o=n}this._apiKey=r,this._baseUrl="".concat(o,"/")}return t.prototype.call=function(t,e){var r,n,o="";return e&&Object.keys(e).forEach((function(t){var r=e[t];r=Array.isArray(r)?r.join(","):r.toString(),o+="&".concat(t,"=").concat(encodeURIComponent(r))})),(r=this._baseUrl+t+(o.length?"?".concat(o.substr(1)):""),n=this._apiKey,new Promise((function(t,e){var o=new XMLHttpRequest;o.open("GET",r,!0),o.setRequestHeader("Crypto-Pay-API-Token",n),o.onreadystatechange=function(){4===o.readyState&&t(o.responseText)},o.onerror=function(){e(new Error("Network Error"))},o.send()}))).then((function(t){var e;try{e=JSON.parse(t)}catch(e){throw new Error("Response parse error, raw reponse:\n".concat(t))}if(!0!==e.ok){if(!e.error)throw new Error("Api response unknown error");throw new Error("Api response error ".concat(JSON.stringify(e.error)))}return e.result}))},t.KEY_CHECK_REGEXP=/\d{1,}:[a-zA-Z0-9]{35}/,t}(),s=function(t,e,r,n){var o,a=null,i=0;return function(s){if(void 0===s&&(s=!1),a)return a;var c=Math.floor(+new Date/1e3/n);return c!==i||s?(i=c,a=t.call(e).then((function(t){return o=r(t),a=null,o}))):Promise.resolve(o)}},c=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t._pageSize=100,t}return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}(r,e),r.prototype.getPageSize=function(){return this._pageSize},r.prototype.setPageSize=function(t){var e=+t;if(e>1e3||e<1)throw Error("Page size may be from 1 to 1000");this._pageSize=e},r.prototype.getBalances=function(t,e){return void 0===t&&(t=!1),void 0===e&&(e=!1),Promise.all([this.getCurrencies(e),this._transport.call("getBalance")]).then((function(e){var r=e[0];return function(t,e,r){return Array.isArray(t)?t.reduce((function(t,n){return n.currency_code&&n.available&&(t[n.currency_code]=r?n.available:function(t,e,r){var n,o=t,a=(null===(n=r[e])||void 0===n?void 0:n.decimals)||8,i=a-o.length;if(i>0){for(var s="",c=0;c<i;c+=1)s+="0";o=s+o}if(o.length===a)o="0.".concat(o);else{var u=o.length-a;o="".concat(o.substr(0,u),".").concat(o.substr(u))}return o.replace(/0+$/,"")}(n.available,n.currency_code,e)),t}),{}):{}}(e[1],r,t)}))},r.prototype.getBalance=function(t,e,r){return void 0===e&&(e=!1),void 0===r&&(r=!1),this.getBalances(e,r).then((function(e){return void 0===e[t]?"0":e[t]}))},r.prototype.getCurrency=function(t,e){return void 0===e&&(e=!1),this.getCurrencies(e).then((function(e){return void 0===e[t]?null:e[t]}))},r.prototype.getExchangeRate=function(t,e,r){return void 0===r&&(r=!1),Promise.all([this.getCurrencies(r),this.getExchangeRates(r)]).then((function(r){var n=r[0],o=r[1];return function(t,e,r,n){for(var o,a=NaN,i=0,s=r.length;i<s;i+=1){var c=r[i];if(c.source===t&&c.target===e){a=c.rate;break}if(c.source===e&&c.target===t){a=1/c.rate;break}}if(isNaN(a))return 0;var u=(null===(o=n[e])||void 0===o?void 0:o.decimals)||8;return parseFloat(a.toFixed(u))}(t,e,o,n)}))},r.prototype.createInvoice=function(t){return this._transport.call("createInvoice",function(t){if(t.description&&t.description.length>1024)throw new Error("Description can't be longer than 1024 characters");if(t.paidBtnName&&!t.paidBtnUrl)throw new Error("Require paidBtnUrl parameter if paidBtnName parameter pass");var e;if(void 0!==t.payload&&(e="string"==typeof t.payload?t.payload:JSON.stringify(t.payload)).length>4096)throw new Error("Payload can't be longer than 4096 characters");var r={asset:t.currency,amount:+t.amount};return void 0!==t.description&&(r.description=t.description),void 0!==e&&(r.payload=e),void 0!==t.paidBtnUrl&&(r.paid_btn_url=t.paidBtnUrl),void 0!==t.paidBtnName&&(r.paid_btn_name=t.paidBtnName),void 0!==t.isAllowComments&&(r.allow_comments=t.isAllowComments),void 0!==t.isAllowAnonymous&&(r.allow_anonymous=t.isAllowAnonymous),r}(t)).then((function(t){return o(t)}))},r.prototype.getInvoices=function(t){return void 0===t&&(t={}),this._transport.call("getInvoices",function(t){var e={};return void 0!==t.status&&(e.status=t.status),void 0!==t.offset&&(e.offset=t.offset),void 0!==t.count&&(e.count=t.count),void 0!==t.currency&&(e.asset=t.currency),void 0!==t.ids&&(e.invoices_ids=t.ids.map((function(t){return+t}))),e}(t)).then((function(t){return e=t,r=[],Array.isArray(e.items)&&(r=e.items.map(o)),{count:e.count||0,items:r};var e,r}))},r.prototype.getInvoicesPaginate=function(t){var e=this;void 0===t&&(t={});var r=function(t,e){var r={};void 0!==e.status&&(r.status=e.status),void 0!==e.currency&&(r.asset=e.currency),void 0!==e.ids&&(r.invoices_ids=e.ids.map((function(t){return+t})));var n=e.page?+e.page:1;return n<1&&(n=1),r.count=t,r.offset=t*(n-1),r}(this._pageSize,t);return this._transport.call("getInvoices",r).then((function(r){return n=t.page,a=e._pageSize,i=r,s=[],Array.isArray(i.items)&&(s=i.items.map(o)),{page:n,pagesCount:Math.ceil((i.count||0)/a),items:s};var n,a,i,s}))},r.prototype.call=function(t,e){return void 0===e&&(e={}),this._transport.call(t,e)},r}(function(){function t(t,e){void 0===e&&(e="mainnet"),this._transport=new i(t,e)}return t.prototype.getCurrencies=function(e){return this._currenciesFetchHandler||(this._currenciesFetchHandler=s(this._transport,"getCurrencies",r,t._CURRENCIES_UPDATE_PERIOD)),this._currenciesFetchHandler(e)},t.prototype.getExchangeRates=function(e){return this._exchangeRatesFetchHandler||(this._exchangeRatesFetchHandler=s(this._transport,"getExchangeRates",n,t._EXCHANGE_RATES_UPDATE_PERIOD)),this._exchangeRatesFetchHandler(e)},t.prototype.getMe=function(e){return void 0===e&&(e=!1),this._meFetchHandler||(this._meFetchHandler=s(this._transport,"getMe",a,t._ME_UPDATE_PERIOD)),this._meFetchHandler(e)},t._CURRENCIES_UPDATE_PERIOD=3600,t._EXCHANGE_RATES_UPDATE_PERIOD=60,t._ME_UPDATE_PERIOD=3600,t}());return c}();
//# sourceMappingURL=crypto-bot-api.min.js.map
